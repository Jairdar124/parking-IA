{% extends "base.html" %}

{% block title %}Inicio - Parking Intelligence{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-6">
        <h1 class="display-4 fw-bold text-dark mb-4">
          Monitoreo Inteligente de <span class="text-primary">Estacionamientos</span>
        </h1>
        <p class="lead text-muted mb-4">
          Sistema avanzado que utiliza visión por computadora para detectar espacios y permitir reservas.
        </p>

        <div class="video-controls" style="margin-top:12px;">
          <button id="btn-connect-home">Conectar cámara</button>
          <button id="btn-disconnect-home">Desconectar cámara</button>
          <span id="home-status" class="small-status"></span>
        </div>

        <div class="mt-4">
          <a href="{{ url_for('mapa') }}" class="btn btn-primary me-2"><i class="bi bi-map"></i> Ver mapa en vivo</a>
          <a href="{{ url_for('reservas') }}" class="btn btn-outline-primary"><i class="bi bi-calendar-plus"></i> Reservas</a>
        </div>
      </div>

      <div class="col-lg-6 text-center">
        <div id="home-video-preview" class="video-container" style="max-width:480px; margin:0 auto; display:none;">
          <img id="home-video" src="/video_feed" alt="Preview" style="width:100%; height:auto; display:none;" />
        </div>
        <div id="home-connect-message" style="margin:24px 0; color:#444; font-size:1.2em;">
          Debes conectar la cámara para ver la vista previa.
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Stats Section -->
<section class="py-4">
  <div class="container">
    <div class="row">
      <div class="col-md-3">
        <div class="stat-card text-center">
          <div class="stat-icon">
            <i class="bi bi-car-front"></i>
          </div>
          <h3 class="stat-number" id="libres">--</h3>
          <p class="stat-label">Espacios Libres</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card text-center">
          <div class="stat-icon occupied">
            <i class="bi bi-x-circle"></i>
          </div>
          <h3 class="stat-number" id="ocupados">--</h3>
          <p class="stat-label">Espacios Ocupados</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card text-center">
          <div class="stat-icon">
            <i class="bi bi-lightning-charge"></i>
          </div>
          <h3 class="stat-number" id="porcentaje">--</h3>
          <p class="stat-label">Ocupación</p>
        </div>
      </div>
      <div class="col-md-3 text-center">
        <small>Última actualización: <span id="lastUpdate">--:--:--</span></small>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/script.js') }}"></script>
<script>
  // añadir acciones para botones en la landing
  document.addEventListener('DOMContentLoaded', function(){
    document.getElementById('btn-connect-home').addEventListener('click', async () => {
      await fetch('/api/start_camera', {method: 'POST'}).catch(()=>{});
      document.getElementById('home-status').textContent = 'Conectando cámara...';
      // Mostrar video y ocultar mensaje
      document.getElementById('home-video-preview').style.display = '';
      document.getElementById('home-video').style.display = '';
      document.getElementById('home-connect-message').style.display = 'none';
      setTimeout(()=> document.getElementById('home-status').textContent = '', 3000);
    });
    document.getElementById('btn-disconnect-home').addEventListener('click', async () => {
      await fetch('/api/stop_camera', {method: 'POST'}).catch(()=>{});
      document.getElementById('home-status').textContent = 'Cámara desconectada';
      // Ocultar video y mostrar mensaje
      document.getElementById('home-video-preview').style.display = 'none';
      document.getElementById('home-video').style.display = 'none';
      document.getElementById('home-connect-message').style.display = '';
      setTimeout(()=> document.getElementById('home-status').textContent = '', 3000);
    });
  });
</script>
{% endblock %}
